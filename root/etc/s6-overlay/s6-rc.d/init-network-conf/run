#!/usr/bin/with-contenv bash
# shellcheck shell=bash


if [[ -n "$LAN_NETWORK" ]]; then

    echo "**** Configuring firewall for local network ****"

    lan_network_item="${LAN_NETWORK}"
    default_gateway_ip="$(ip route | grep default | cut -d " " -f 3)"
    default_gateway_adapter="$(ip route | grep default | cut -d " " -f 5)"

    ip route add "${lan_network_item}" via "${default_gateway_ip}" dev "${default_gateway_adapter}"

else

    echo "**** No local LAN specified ****"

fi

# Ubuntu hacks
echo "**** Patching wg-quick for Ubuntu ****"
sed -i 's/} | cmd resolvconf -a "$(resolvconf_iface_prefix)$INTERFACE" -m 0 -x/} | cmd tee > \/etc\/resolv.conf/' /usr/bin/wg-quick
