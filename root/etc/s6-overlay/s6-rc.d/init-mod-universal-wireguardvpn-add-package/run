#!/usr/bin/with-contenv bash

## Ubuntu
if [ -f /usr/bin/apt ]; then
    echo "**** Adding universal-wireguardvpn packages to install lists ****"
    echo "\
        iptables \
        ip6tables \
        iputils-ping \
        systemd-resolved \
        wireguard" >> /mod-repo-packages-to-install.list

    curl -o /coredns.tgz -L https://github.com/coredns/coredns/releases/download/v1.11.3/coredns_1.11.3_linux_amd64.tgz
    tar xf /coredns.tgz
    cp coredns /usr/local/bin/
fi

# Alpine
if [ -f /sbin/apk ]; then
    if ! apk info --installed wireguard-tools >/dev/null; then
        echo "**** Adding universal-wireguardvpn packages to install lists ****"
        echo "\
            grep \
            iproute2 \
            iptables \
            iptables-legacy \
            ip6tables \
            iputils \
            libcap-utils \
            net-tools \
            wireguard-tools" >> /mod-repo-packages-to-install.list
    else
        echo "**** Universal-wireguardvpn packages already installed, skipping ****"
    fi
fi
